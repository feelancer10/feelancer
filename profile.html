<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Profile — Feelancer10</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0077FF, #00E0FF);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  header {
    width: 100%;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    padding: 15px 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  header h2 { margin: 0; }
  #logout { cursor: pointer; color: #00E0FF; }

  .profile-container {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    margin-top: 40px;
    padding: 30px;
    width: 90%;
    max-width: 450px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #00E0FF;
    margin-bottom: 15px;
  }

  input, textarea, select {
    width: 100%;
    padding: 10px 15px;
    margin: 10px 0;
    border: none;
    border-radius: 10px;
    outline: none;
    font-size: 15px;
  }

  button {
    background: white;
    color: #0077FF;
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover { background: #00E0FF; color: white; }
</style>
</head>
<body>

<header>
  <h2>Feelancer10 Profile</h2>
  <div id="logout">Logout</div>
</header>

<div class="profile-container">
  <img id="profilePic" src="https://via.placeholder.com/120" alt="Profile">
  <input type="file" id="uploadPic" accept="image/*">

  <input id="name" placeholder="Full Name">
  <select id="role">
    <option value="freelancer">Freelancer</option>
    <option value="client">Client</option>
    <option value="both">Both</option>
  </select>
  <textarea id="skills" placeholder="Your Skills (e.g., Web Design, Writing)"></textarea>
  <textarea id="bio" placeholder="About You..."></textarea>

  <button id="saveBtn">Save Profile</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDTAI93GPDjSYaUTNuRDRD_EaI5KgAKga4",
    authDomain: "feelancer10.firebaseapp.com",
    projectId: "feelancer10",
    storageBucket: "feelancer10.firebasestorage.app",
    messagingSenderId: "493511381411",
    appId: "1:493511381411:web:c095b15d707a758ba08a16"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const nameInput = document.getElementById('name');
  const roleInput = document.getElementById('role');
  const skillsInput = document.getElementById('skills');
  const bioInput = document.getElementById('bio');
  const uploadPic = document.getElementById('uploadPic');
  const profilePic = document.getElementById('profilePic');
  const saveBtn = document.getElementById('saveBtn');
  const logout = document.getElementById('logout');

  logout.onclick = () => signOut(auth).then(() => location.href = 'auth.html');

  let currentUser = null;

  onAuthStateChanged(auth, async (user) => {
    if (!user) return location.href = 'auth.html';
    currentUser = user;
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const data = docSnap.data();
      nameInput.value = data.name || '';
      roleInput.value = data.role || 'freelancer';
      skillsInput.value = data.skills || '';
      bioInput.value = data.bio || '';
      if (data.photoURL) profilePic.src = data.photoURL;
    }
  });

  uploadPic.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file || !currentUser) return;
    const imgRef = ref(storage, `profilePics/${currentUser.uid}.jpg`);
    await uploadBytes(imgRef, file);
    const url = await getDownloadURL(imgRef);
    profilePic.src = url;
    await setDoc(doc(db, "users", currentUser.uid), { photoURL: url }, { merge: true });
  });

  saveBtn.onclick = async () => {
    if (!currentUser) return;
    const data = {
      name: nameInput.value,
      role: roleInput.value,
      skills: skillsInput.value,
      bio: bioInput.value
    };
    await setDoc(doc(db, "users", currentUser.uid), data, { merge: true });
    alert("✅ Profile updated successfully!");
  };
</script>

</body>
</html>
