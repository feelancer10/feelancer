<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wallet â€” Feelancer10</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0077FF, #00E0FF);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  header {
    width: 100%;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    padding: 15px 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  header h2 { margin: 0; }
  #logout { cursor: pointer; color: #00E0FF; }

  .wallet-container {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    margin-top: 40px;
    padding: 30px;
    width: 90%;
    max-width: 500px;
    text-align: center;
    animation: fadeIn 1s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h3 { margin-bottom: 10px; }
  .balance {
    font-size: 35px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 20px;
  }

  input, button {
    width: 100%;
    padding: 12px 15px;
    margin: 10px 0;
    border: none;
    border-radius: 10px;
    font-size: 16px;
  }

  input { outline: none; }
  button {
    background: white;
    color: #0077FF;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover { background: #00E0FF; color: white; }

  .upi-box {
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 15px;
    margin-top: 20px;
    font-size: 14px;
  }

  .transactions {
    margin-top: 25px;
    background: rgba(0,0,0,0.2);
    border-radius: 15px;
    padding: 15px;
  }
  .transactions h4 { margin-top: 0; }
  .txn {
    padding: 8px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
  }
</style>
</head>
<body>

<header>
  <h2>Feelancer10 Wallet</h2>
  <div id="logout">Logout</div>
</header>

<div class="wallet-container">
  <h3>Your Wallet Balance</h3>
  <div class="balance" id="balance">â‚¹0</div>

  <input id="amount" type="number" placeholder="Enter amount (â‚¹)">
  <button id="addBtn">Add Balance</button>
  <button id="withdrawBtn">Withdraw Balance</button>

  <div class="upi-box">
    <strong>ðŸ’¸ Manual UPI (Temporary):</strong><br>
    Send to <b>9019254743@axl</b> and upload proof on Support Page.
  </div>

  <div class="transactions">
    <h4>Transaction History</h4>
    <div id="txnList"></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDTAI93GPDjSYaUTNuRDRD_EaI5KgAKga4",
    authDomain: "feelancer10.firebaseapp.com",
    projectId: "feelancer10",
    storageBucket: "feelancer10.firebasestorage.app",
    messagingSenderId: "493511381411",
    appId: "1:493511381411:web:c095b15d707a758ba08a16"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const balanceDisplay = document.getElementById("balance");
  const amountInput = document.getElementById("amount");
  const addBtn = document.getElementById("addBtn");
  const withdrawBtn = document.getElementById("withdrawBtn");
  const txnList = document.getElementById("txnList");
  const logout = document.getElementById("logout");

  logout.onclick = () => signOut(auth).then(() => location.href = 'auth.html');

  let userDocRef;
  let userId;

  onAuthStateChanged(auth, async (user) => {
    if (!user) return location.href = "auth.html";
    userId = user.uid;
    userDocRef = doc(db, "wallets", userId);

    const docSnap = await getDoc(userDocRef);
    if (!docSnap.exists()) {
      await setDoc(userDocRef, { balance: 0 });
      balanceDisplay.textContent = "â‚¹0";
    } else {
      balanceDisplay.textContent = "â‚¹" + (docSnap.data().balance || 0);
    }
    loadTransactions();
  });

  async function loadTransactions() {
    const q = query(collection(db, "wallets", userId, "transactions"), orderBy("time", "desc"));
    const docs = await getDocs(q);
    txnList.innerHTML = "";
    docs.forEach((tx) => {
      const data = tx.data();
      const div = document.createElement("div");
      div.className = "txn";
      div.innerHTML = `${data.type} â‚¹${data.amount} â€” ${new Date(data.time).toLocaleString()}`;
      txnList.appendChild(div);
    });
  }

  addBtn.onclick = async () => {
    const amt = parseInt(amountInput.value);
    if (!amt || amt <= 0) return alert("Enter valid amount");
    const docSnap = await getDoc(userDocRef);
    const newBal = (docSnap.data().balance || 0) + amt;
    await updateDoc(userDocRef, { balance: newBal });
    await addDoc(collection(db, "wallets", userId, "transactions"), { type: "Added", amount: amt, time: Date.now() });
    balanceDisplay.textContent = "â‚¹" + newBal;
    loadTransactions();
    alert("âœ… Amount added manually. Send to your UPI and confirm via Support.");
  };

  withdrawBtn.onclick = async () => {
    const amt = parseInt(amountInput.value);
    if (!amt || amt <= 0) return alert("Enter valid amount");
    const docSnap = await getDoc(userDocRef);
    const bal = docSnap.data().balance || 0;
    if (bal < amt) return alert("âŒ Insufficient balance.");
    const newBal = bal - amt;
    await updateDoc(userDocRef, { balance: newBal });
    await addDoc(collection(db, "wallets", userId, "transactions"), { type: "Withdrawn", amount: amt, time: Date.now() });
    balanceDisplay.textContent = "â‚¹" + newBal;
    loadTransactions();
    alert("âœ… Withdraw request submitted. Amount will be sent to your linked UPI.");
  };
</script>

</body>
</html>
